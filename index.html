<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººç”Ÿæ´»ç®¡ç†çœ‹æ¿</title>
    <style>
        :root {
            --bg: #FFF9F3; --accent: #D4A373; --text: #5D534A;
            --white: #FFFFFF; --soft-bg: #FAF3E0;
            --water-blue: #A9D1DF; --sport-orange: #E6BAA3;
        }
        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center;
        }
        .container { max-width: 600px; width: 100%; }
        .card {
            background: var(--white); border-radius: 25px; padding: 25px;
            box-shadow: 0 10px 40px rgba(212, 163, 115, 0.1); margin-bottom: 20px;
        }
        .header { text-align: center; margin-bottom: 20px; }
        .day-title { font-size: 1.4rem; color: var(--accent); font-weight: bold; margin: 10px 0; }
        
        /* ç¿’æ…£æ‰“å¡ */
        .habit-tracker { display: flex; justify-content: center; margin: 15px 0; gap: 20px; }
        .habit-circle {
            width: 45px; height: 45px; border-radius: 50%; border: 2px solid #EEE;
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 5px; cursor: pointer; transition: 0.3s; font-size: 1.1rem; background: #FFF;
        }
        .habit-circle.active-water { background-color: var(--water-blue); border-color: var(--water-blue); color: white; }
        .habit-circle.active-sport { background-color: var(--sport-orange); border-color: var(--sport-orange); color: white; }
        .habit-label { font-size: 0.7rem; opacity: 0.8; }

        /* æ™‚é–“è»¸ç·¨è¼¯æ¨£å¼ */
        .timeline { position: relative; border-left: 2px solid var(--soft-bg); margin-left: 10px; padding-left: 25px; }
        .schedule-item { margin-bottom: 12px; position: relative; display: flex; flex-direction: column; }
        .schedule-item::before {
            content: ''; position: absolute; left: -31px; top: 5px;
            width: 10px; height: 10px; background: var(--accent); border-radius: 50%;
        }
        .time-input, .task-input { border: none; background: transparent; font-family: inherit; color: inherit; width: 100%; outline: none; }
        .time-input { font-size: 0.8rem; font-weight: bold; color: var(--accent); }
        .task-input { font-size: 0.95rem; border-bottom: 1px solid transparent; }
        .task-input:focus { border-bottom: 1px solid var(--soft-bg); }

        /* å¾…è¾¦å€ */
        .todo-section { background: var(--soft-bg); border-radius: 20px; padding: 20px; }
        .input-group { display: flex; gap: 8px; margin-bottom: 15px; }
        input[type="text"] { flex: 1; border: 1px solid #E6D5C3; border-radius: 8px; padding: 8px; outline: none; }
        .add-btn { background: var(--accent); color: white; border: none; border-radius: 8px; padding: 0 15px; cursor: pointer; }
        .todo-item { display: flex; align-items: center; justify-content: space-between; background: #FFF; padding: 8px 12px; border-radius: 10px; margin-bottom: 8px; font-size: 0.9rem; }
        .todo-item.done span { text-decoration: line-through; opacity: 0.5; }

        /* å¿ƒæƒ…ç´€éŒ„å€ */
        .mood-box { display: flex; justify-content: center; gap: 15px; margin: 15px 0; }
        .mood-btn { font-size: 1.4rem; border: none; background: none; cursor: pointer; transition: 0.2s; }
        .history-list { font-size: 0.85rem; border-top: 1px dashed var(--accent); padding-top: 10px; margin-top: 10px; }
        .history-entry { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #FAF3E0; }

        .btn-group { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .icon-btn { background: var(--soft-bg); color: var(--accent); border: none; border-radius: 50px; padding: 6px 18px; cursor: pointer; font-size: 0.8rem; }
        .surprise-btn { background: #E6BAA3; color: white; border: none; border-radius: 50px; padding: 10px 25px; cursor: pointer; font-size: 14px; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <div class="header">
            <div id="date-text" style="opacity: 0.6; font-size: 0.8rem;"></div>
            <div id="day-text" class="day-title" contenteditable="true">è‡ªå®šç¾©ä»Šæ—¥ç›®æ¨™</div>
            
            <div class="habit-tracker">
                <div onclick="toggleHabit('water')"><div id="habit-water" class="habit-circle">ğŸ’§</div><div class="habit-label">å¤šå–æ°´</div></div>
                <div onclick="toggleHabit('sport')"><div id="habit-sport" class="habit-circle">ğŸƒ</div><div class="habit-label">æœ‰é‹å‹•</div></div>
            </div>

            <button class="surprise-btn" onclick="getSurprise()">âœ¨ ä»Šæ—¥é©šå–œ</button>
        </div>

        <div id="editable-schedule" class="timeline"></div>

        <div class="btn-group">
            <button class="icon-btn" onclick="addItem()">+ å¢åŠ è¡Œç¨‹</button>
            <button class="icon-btn" onclick="saveSchedule()" style="background: var(--accent); color: white;">ğŸ’¾ å„²å­˜è¡Œç¨‹</button>
        </div>
    </div>

    <div class="card todo-section">
        <h4 style="margin: 0 0 15px 0;">ğŸ“ å¾…è¾¦æ¸…å–®</h4>
        <div class="input-group">
            <input type="text" id="todo-input" placeholder="æƒ³åšé»ä»€éº¼ï¼Ÿ">
            <button class="add-btn" onclick="addTodo()">æ–°å¢</button>
        </div>
        <div id="todo-list"></div>
    </div>

    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h4 style="margin: 0;">ğŸ—“ï¸ å¿ƒæƒ…æ—¥è¨˜</h4>
            <button onclick="clearMoodHistory()" style="font-size: 0.7rem; color: #BBB; background: none; border: 1px solid #EEE; border-radius: 10px; cursor: pointer;">æ¸…é™¤</button>
        </div>
        <div class="mood-box">
            <button class="mood-btn" onclick="logMood('ğŸ¥°')">ğŸ¥°</button>
            <button class="mood-btn" onclick="logMood('ğŸ˜Š')">ğŸ˜Š</button>
            <button class="mood-btn" onclick="logMood('â˜¹ï¸')">â˜¹ï¸</button>
            <button class="mood-btn" onclick="logMood('ğŸ˜­')">ğŸ˜­</button>
        </div>
        <div id="mood-history" class="history-list"></div>
    </div>
</div>

<script>
    // --- è¡Œç¨‹è¦åŠƒé‚è¼¯ ---
    const defaultTasks = [
        { time: "09:00 - 10:00", task: "æ™¨é–“å„€å¼" },
        { time: "10:00 - 12:00", task: "å°ˆæ³¨æ™‚é–“" }
    ];
    let userTasks = JSON.parse(localStorage.getItem('user_schedule')) || defaultTasks;

    function renderSchedule() {
        const container = document.getElementById('editable-schedule');
        container.innerHTML = userTasks.map((t, i) => `
            <div class="schedule-item">
                <input class="time-input" value="${t.time}" onchange="userTasks[${i}].time=this.value">
                <input class="task-input" value="${t.task}" onchange="userTasks[${i}].task=this.value">
                <span onclick="deleteItem(${i})" style="position:absolute; right:0; top:10px; cursor:pointer; opacity:0.3;">âœ•</span>
            </div>
        `).join('');
    }

    function addItem() { userTasks.push({ time: "æ™‚é–“", task: "æ–°ä»»å‹™" }); renderSchedule(); }
    function deleteItem(i) { userTasks.splice(i, 1); renderSchedule(); }
    function saveSchedule() { localStorage.setItem('user_schedule', JSON.stringify(userTasks)); alert("è¡Œç¨‹å·²å„²å­˜ï¼"); }

    // --- å¾…è¾¦æ¸…å–®é‚è¼¯ ---
    let todos = JSON.parse(localStorage.getItem('my_todos')) || [];
    function addTodo() {
        const input = document.getElementById('todo-input');
        if (!input.value.trim()) return;
        todos.push({ text: input.value, done: false });
        input.value = ""; saveAndRenderTodos();
    }
    function saveAndRenderTodos() {
        localStorage.setItem('my_todos', JSON.stringify(todos));
        document.getElementById('todo-list').innerHTML = todos.map((t, i) => `
            <div class="todo-item ${t.done ? 'done' : ''}">
                <div onclick="todos[${i}].done=!todos[${i}].done;saveAndRenderTodos()" style="flex:1; cursor:pointer;">
                    <input type="checkbox" ${t.done?'checked':''}> <span>${t.text}</span>
                </div>
                <button onclick="todos.splice(${i},1);saveAndRenderTodos()" style="border:none; background:none; color:#CCC;">âœ•</button>
            </div>`).join('');
    }

    // --- å¿ƒæƒ…ç´€éŒ„é‚è¼¯ ---
    function logMood(mood) {
        const now = new Date();
        const dateStr = now.toLocaleDateString();
        let history = JSON.parse(localStorage.getItem('mood_logs')) || [];
        const todayIdx = history.findIndex(h => h.date === dateStr);
        if (todayIdx > -1) history[todayIdx].mood = mood;
        else history.unshift({ date: dateStr, mood: mood });
        localStorage.setItem('mood_logs', JSON.stringify(history.slice(0, 10)));
        renderMoodHistory();
    }
    function renderMoodHistory() {
        const history = JSON.parse(localStorage.getItem('mood_logs')) || [];
        document.getElementById('mood-history').innerHTML = history.length === 0 ? "<p style='opacity:0.5;'>å°šæœªè¨˜éŒ„å¿ƒæƒ…</p>" : 
            history.map(h => `<div class="history-entry"><span>${h.date}</span><span>${h.mood}</span></div>`).join('');
    }
    function clearMoodHistory() { if(confirm("ç¢ºå®šæ¸…é™¤ç´€éŒ„ï¼Ÿ")) { localStorage.removeItem('mood_logs'); renderMoodHistory(); } }

    // --- ç¿’æ…£èˆ‡é©šå–œ ---
    let habitData = JSON.parse(localStorage.getItem('habits')) || { date: "", water: false, sport: false };
    function loadHabits() {
        const today = new Date().toLocaleDateString();
        if (habitData.date !== today) habitData = { date: today, water: false, sport: false };
        updateHabitUI();
    }
    function toggleHabit(type) {
        habitData[type] = !habitData[type];
        localStorage.setItem('habits', JSON.stringify(habitData));
        updateHabitUI();
    }
    function updateHabitUI() {
        document.getElementById('habit-water').className = habitData.water ? 'habit-circle active-water' : 'habit-circle';
        document.getElementById('habit-sport').className = habitData.sport ? 'habit-circle active-sport' : 'habit-circle';
    }
    function getSurprise() {
        alert("ç„¡è«–ä»Šå¤©è¨ˆç•«å®Œæˆå¤šå°‘ï¼Œå¦³éƒ½å·²ç¶“å¾ˆæ£’äº†ï¼âœ¨");
    }

    // åˆå§‹åŒ–
    window.onload = function() {
        const now = new Date();
        document.getElementById('date-text').innerText = now.toLocaleDateString();
        renderSchedule();
        saveAndRenderTodos();
        renderMoodHistory();
        loadHabits();
    };
</script>
</body>
</html>